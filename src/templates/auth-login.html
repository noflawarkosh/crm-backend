<!DOCTYPE html>

<html lang="ru" class="light-style layout-wide  customizer-hide" dir="ltr" data-theme="theme-default"
      data-assets-path="../../assets/" data-template="vertical-menu-template">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"/>

    <title>GreedyBear - Вход</title>


    <link rel="icon" type="image/x-icon" href="../../assets/img/favicon/favicon.ico"/>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
          rel="stylesheet">

    <link rel="stylesheet" href="{{ url_for('static', path='assets/vendor/fonts/boxicons.css') }}"/>
    <link rel="stylesheet" href="{{ url_for('static', path='assets/vendor/fonts/fontawesome.css') }}"/>
    <link rel="stylesheet" href="{{ url_for('static', path='assets/vendor/fonts/flag-icons.css') }}"/>
    <link rel="stylesheet" href="{{ url_for('static', path='assets/vendor/css/rtl/core.css') }}"
          class="template-customizer-core-css"/>
    <link rel="stylesheet" href="{{ url_for('static', path='assets/vendor/css/rtl/theme-default.css') }}"
          class="template-customizer-theme-css"/>
    <link rel="stylesheet" href="{{ url_for('static', path='assets/css/demo.css') }}"/>
    <link rel="stylesheet"
          href="{{ url_for('static', path='assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css') }}"/>
    <link rel="stylesheet" href="{{ url_for('static', path='assets/vendor/libs/typeahead-js/typeahead.css') }}"/>
    <link rel="stylesheet"
          href="{{ url_for('static', path='assets/vendor/libs/@form-validation/form-validation.css') }}"/>
    <link rel="stylesheet" href="{{ url_for('static', path='assets/vendor/css/pages/page-auth.css') }}">

    <script src="{{ url_for('static', path='assets/vendor/js/helpers.js') }}"></script>
    <script src="{{ url_for('static', path='assets/js/config.js') }}"></script>


</head>

<body>


<div class="authentication-wrapper authentication-cover">
    <div class="authentication-inner row m-0">

        <!-- /Left Text -->
        <div class="d-none d-lg-flex col-lg-7 col-xl-8 align-items-center p-5">
            <div class="w-100 d-flex justify-content-center">
                <img src="{{ url_for('static', path='assets/img/illustrations/girl-with-laptop-light.png') }}"
                     class="img-fluid" alt="Login image"
                     width="700" data-app-dark-img="illustrations/girl-with-laptop-dark.png"
                     data-app-light-img="illustrations/girl-with-laptop-light.png">

            </div>
        </div>
        <!-- /Left Text -->

        <!-- Register -->
        <div class="d-flex col-12 col-lg-5 col-xl-4 align-items-center authentication-bg p-sm-5 p-4">
            <div class="w-px-400 mx-auto">
                <!-- Logo -->
                <div class="app-brand mb-5">
                    <a href="index.html" class="app-brand-link gap-2">
                        <span class="app-brand-text demo text-body fw-bold">greedybear</span>
                    </a>
                </div>
                <!-- /Logo -->
                <h4 class="mb-4">Аутентификация</h4>


                <form id="login">

                    <div class="mb-3">
                        <label for="username" class="form-label">Логин *</label>
                        <input type="text" class="form-control" id="username" name="username"
                               placeholder="username" autofocus autocomplete="nofill">
                    </div>

                    <div class="mb-3 form-password-toggle">
                        <label class="form-label" for="password">Пароль *</label>
                        <div class="input-group input-group-merge">
                            <input type="password" id="password" class="form-control" name="password"
                                   aria-describedby="password" autocomplete="nofill"/>
                            <span class="input-group-text cursor-pointer"><i class="bx bx-hide" id="password-toggle"></i></span>
                        </div>
                    </div>

                    <button class="btn btn-primary d-grid w-100 mt-2" type="submit">
                        Войти
                    </button>
                </form>

                <p class="text-center mt-2">
                    <span>Нет учетной записи?</span>
                    <a href="/v1/register">
                        <span>Зарегистрироваться</span>
                    </a>
                </p>

            </div>
        </div>

    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/3.3.4/jquery.inputmask.bundle.min.js"></script>

<script>
    // Show password buttons
    $(document).ready(function () {
        $('#password-toggle').click(function () {
            var input = $('#password');
            var icon = $('#password-toggle');
            if (input.attr('type') === 'password') {
                input.attr('type', 'text');
                icon.removeClass('bx-hide').addClass('bx-show');
            } else {
                input.attr('type', 'password');
                icon.removeClass('bx-show').addClass('bx-hide');
            }
        });
    });
</script>

<script>
    // Inputmasks
    $(document).ready(function () {

        passwordOptions = {
            mask: '*{8,16}',
            definitions: {
                '*': {
                    validator: '[A-Za-z0-9!@#$%^&*]',
                },
            }
        };

        usernameOptions = {
            mask: '*{5,20}',
            definitions: {
                '*': {
                    validator: '[a-z0-9]',
                },
            }
        };

        $('#username').inputmask(usernameOptions);
        $('#password').inputmask(passwordOptions);

    });
</script>

<script>
    document.getElementById('login').addEventListener('submit', function (event) {

        event.preventDefault();

        var submitButton = document.querySelector('button[type="submit"]');
        submitButton.classList.add('disabled');

        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');

        if ((usernameInput.value.length < 5) || (usernameInput.value.length > 20)) {
            alert('Укажите логин (5-20 символов)')
            submitButton.classList.remove('disabled');
            return
        }

        if ((passwordInput.value.length < 8) || (passwordInput.value.length > 16)) {
            alert('Укажите пароль (8-16 символов)')
            submitButton.classList.remove('disabled');
            return
        }

        const currentDomain = window.location.origin;
        const url = new URL('/auth/login', currentDomain);
        url.searchParams.append('username', usernameInput.value);
        url.searchParams.append('password', passwordInput.value);

        $.ajax({
            url: url,
            method: 'post',
            success: function (data) {
                if (data.result === 'success') {
                    location.reload()
                }

                if (data.result === 'error') {
                    alert(data.details)
                }
                submitButton.classList.remove('disabled');
            },

            error: function () {
                alert('Произошла ошибка сервера при аутентификации. Обновите страницу и повторите попытку');
                submitButton.classList.remove('disabled');
            }
        });

    });
</script>


</body>

</html>
